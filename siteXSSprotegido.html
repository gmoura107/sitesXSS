<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Demonstrativo XSS protegido</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #2c3e50; color: #333; padding: 20px; }
        h1 { color: #ecf0f1; text-align: center; }
        
      
        .secao-ataque {
            background: #ecf0f1;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 10px solid;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

     
        .refletido { border-color: #e74c3c; } 
        .dom { border-color: #f1c40f; }       
        .persistente { border-color: #8e44ad; } 

        h2 { margin-top: 0; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; }
        
        .btn-busca { background-color: #f39c12; }
        .btn-postar { background-color: #8e44ad; }
        .btn-limpar { background-color: #7f8c8d; margin-top: 5px;}

        .resultado-box { 
            background: #fff; 
            border: 1px dashed #999; 
            padding: 10px; 
            margin-top: 10px; 
            min-height: 30px; 
            word-break: break-all;
        }

        code { background: #333; color: #0f0; padding: 2px 5px; border-radius: 3px; font-size: 0.9em; }
    </style>
</head>
<body>

    <h1>Site protegido de ataques XSS</h1>

    <div class="secao-ataque refletido">
        <h2>1. Proteção contra XSS Refletido</h2>
        
        <p><strong>Copie este código: <code>?msg=&lt;img src=x onerror=alert('ATAQUE_XSS_REFLETIDO')&gt;</code> e cole no final da URL para tentar o ataque.</strong></p>
        
        <p> <strong>Resultado esperado: O código aparecerá como texto, mas o alerta NÃO vai abrir.</strong></p>
        <div id="resultado-refletido" class="resultado-box">
            (Aguardando parâmetro na URL...)
        </div>
    </div>

    <div class="secao-ataque dom">
        <h2>2. Proteção contra XSS DOM </h2>
        <p>Tente pesquisar por: <code>&lt;img src=x onerror=alert('ATAQUE_XSS_DOM')&gt;</code></p>
        
        <input type="text" id="input-dom" placeholder="Digite aqui o que deseja pesquisar...">
        <button onclick="ataqueDom()" class="btn-busca">Pesquisar</button>

        <div id="resultado-dom" class="resultado-box"></div>
    </div>

    <div class="secao-ataque persistente">
        <h2>3. Proteção contra XSS Persistente</h2>
        
        <p>O que você digitar aqui fica salvo, mas será limpo antes de ser exibido.</p>
        <p>Tente comentar: <code>&lt;img src=x onerror=alert('ATAQUE_XSS_PERSISTENTE')&gt;</code> </p>
        
        <textarea id="input-persistente" placeholder="Digite aqui seu comentário..."></textarea>
        <button onclick="postarComentario()" class="btn-postar">Postar Comentário</button>
        <button onclick="limparBanco()" class="btn-limpar">Limpar todos os comentarios</button>

        <div id="lista-comentarios">
            </div>
    </div>

    <script>
        // --- FUNÇÃO DE SANITIZAÇÃO ---
        // Esta função é a responsável por fazer a Sanitização dos dados inseridos, tratando o texto e evitando ataques.
        function sanitizar(texto) {
            if (!texto) return "";
            return texto
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")  
                .replace(/>/g, "&gt;") 
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // --- TRATANDO O ATAQUE REFLETIDO ---
        const params = new URLSearchParams(window.location.search);
        const msg = params.get('msg');
        if (msg) {
            // Aqui é aplicada a sanitização do DADO - "sanitizar(msg)"
            document.getElementById('resultado-refletido').innerHTML = "<b>Foi notado o parâmetro porém não houve o ataque:</b> " + sanitizar(msg);
        }

        // --- 2. TRATANDO O ATAQUE DOM-BASED ---
        function ataqueDom() {
            const input = document.getElementById('input-dom').value;
            const div = document.getElementById('resultado-dom');
            
            // Aqui é aplicada a sanitização do dado - "sanitizar(input)"
            div.innerHTML = "Resultados da pesquisa para: " + sanitizar(input);
        }

        // --- 3. TRATANDO O ATAQUE PERSISTENTE ---
        function carregarComentarios() {
            const lista = JSON.parse(localStorage.getItem('banco_vulneravel')) || [];
            const div = document.getElementById('lista-comentarios');
            div.innerHTML = ""; 
            
            lista.forEach(texto => {
                // Aqui é aplicada a sanitização do DADO - "sanitizar(texto)".
                div.innerHTML += `<div class="resultado-box" style="background:#f3e5f5;">${sanitizar(texto)}</div>`;
            });
        }

        function postarComentario() {
            const texto = document.getElementById('input-persistente').value;
            let lista = JSON.parse(localStorage.getItem('banco_vulneravel')) || [];
            
            // Nota: Podemos salvar o dado "sujo" no banco e limpar na saída (como fiz acima),
            // ou limpar agora antes de salvar. Limpar na saída é geralmente mais flexível.
            lista.push(texto);
            localStorage.setItem('banco_vulneravel', JSON.stringify(lista));
            
            carregarComentarios(); 
            document.getElementById('input-persistente').value = ""; 
        }

        function limparBanco() {
            localStorage.removeItem('banco_vulneravel');
            location.reload(); 
        }

        carregarComentarios();

    </script>
</body>
</html>